<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Appointment Booking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 30px;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
    }
    input, textarea, select, button {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      font-size: 14px;
    }
    button {
      background: #4f46e5;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background: #4338ca;
    }
    .slots button {
      margin-top: 5px;
      background: #e5e7eb;
      color: black;
    }
    .slots button.selected {
      background: #4f46e5;
      color: white;
    }
    .status {
      margin-top: 15px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Book Appointment</h2>

  <input id="name" placeholder="Your Name">
  <input id="email" placeholder="Email">
  <input id="phone" placeholder="Phone">
  <textarea id="purpose" placeholder="Purpose"></textarea>

  <select id="duration">
    <option value="15">15 Minutes</option>
    <option value="30">30 Minutes</option>
    <option value="45">45 Minutes</option>
  </select>

  <h3>Select Time Slot</h3>
  <div id="slots" class="slots"></div>

  <button onclick="book()">Book Appointment</button>

  <div id="status" class="status"></div>
</div>

<script>
/* üî¥ CHANGE ONLY THIS */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxR3vs1VnwzlZqd6G_YHkhRdIKpG96DQIGiSe3E6U-UV0wzHvowd2Pm9X5NMsd2suvj/exec";

let selectedSlot = null;

/* LOAD SLOTS */
fetch(`${SCRIPT_URL}?action=getSlots&week=current&duration=15`)
  .then(r => r.json())
  .then(data => {
    const slotsDiv = document.getElementById("slots");
    data.slots.forEach(day => {
      const h4 = document.createElement("h4");
      h4.textContent = day.date;
      slotsDiv.appendChild(h4);

      day.slots.forEach(slot => {
        if (slot.booked) return;

        const btn = document.createElement("button");
        btn.textContent = slot.time;
        btn.onclick = () => {
          document.querySelectorAll(".slots button").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          selectedSlot = slot;
        };
        slotsDiv.appendChild(btn);
      });
    });
  });

/* BOOK APPOINTMENT */
function book() {
  if (!selectedSlot) {
    alert("Please select a slot");
    return;
  }

  const payload = {
    action: "bookAppointment",
    name: name.value,
    email: email.value,
    phone: phone.value,
    purpose: purpose.value,
    duration: duration.value,
    slotStart: selectedSlot.start
  };

  document.getElementById("status").textContent = "Booking...";

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(r => r.json())
  .then(res => {
    if (res.success) {
      document.getElementById("status").textContent = "‚úÖ Appointment booked!";
    } else {
      document.getElementById("status").textContent = "‚ùå " + res.error;
    }
  })
  .catch(err => {
    document.getElementById("status").textContent = "‚ùå Network error";
  });
}
</script>

</body>
</html>
